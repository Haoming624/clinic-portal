<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Clinic Portal" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" crossorigin="anonymous">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>

    <%= javascript_importmap_tags %>

    <style>
      .navbar-custom {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        padding: 0.75rem 1.5rem;
      }
      
      .navbar-brand-custom {
        font-weight: 600;
        color: #2c3e50;
        font-size: 1.1rem;
      }
      
      .user-email {
        color: #6c757d;
        font-size: 0.9rem;
      }
      
      .main-container {
        margin-top: 1.5rem;
      }
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>

  <body>
    <% if user_signed_in? %>
      <nav class="navbar navbar-custom navbar-expand-lg">
        <div class="container-fluid">
          <span class="navbar-brand navbar-brand-custom mb-0">
            <i class="bi bi-hospital me-2"></i>
            Clinic Portal - <%= current_user.role.capitalize %>
          </span>
          
          <div class="d-flex align-items-center gap-3">
            <% if current_user.doctor? %>
              <%= link_to "#{doctor_dashboard_path}#analytics", class: "btn btn-outline-primary btn-sm" do %>
                <i class="bi bi-bar-chart-line me-1"></i> Analytics
            <% end %>
          <% end %>
          
            <span class="user-email">
              <i class="bi bi-person-circle me-1"></i>
              <%= current_user.email %>
            </span>

            <%= button_to "Logout", destroy_user_session_path, method: :delete, 
                class: "btn btn-outline-danger btn-sm", 
                form: { class: "d-inline" } %>
          </div>
        </div>
      </nav>
    <% end %>

    <div class="container main-container">
      <%= render 'shared/flash' %>
      <%= yield %>
    </div>

    <!-- Bootstrap JS via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>  
  </body>
</html>