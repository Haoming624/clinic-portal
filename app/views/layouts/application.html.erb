<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title><%= content_for(:title) || "Clinic Portal" %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Preload important resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js" as="script">

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= yield :head %>

    <!-- CDN Resources -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" crossorigin="anonymous">

    <style>
      :root {
        --clinic-primary: #3498db;
        --clinic-secondary: #6c757d;
        --clinic-light: #f8f9fa;
        --clinic-dark: #2c3e50;
        --clinic-border: #dee2e6;
      }

      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        scroll-behavior: smooth;
      }

      .navbar-custom {
        background-color: var(--clinic-light);
        border-bottom: 1px solid var(--clinic-border);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 0.75rem 1.5rem;
      }

      .navbar-brand-custom {
        font-weight: 600;
        color: var(--clinic-dark);
        font-size: 1.1rem;
      }

      .user-email {
        color: var(--clinic-secondary);
        font-size: 0.9rem;
      }

      .main-container {
        margin-top: 1.5rem;
        flex-grow: 1;
      }

      footer {
        background-color: var(--clinic-light);
        border-top: 1px solid var(--clinic-border);
      }
    </style>
  </head>

  <body>
    <% if user_signed_in? %>
      <nav class="navbar navbar-custom navbar-expand-lg">
        <div class="container-fluid">
          <a class="navbar-brand navbar-brand-custom" href="<%= (current_user.receptionist? ? receptionist_dashboard_path : doctor_dashboard_path) %>">
            <i class="bi bi-hospital me-2"></i>
            Clinic Portal - <%= current_user.role.capitalize %>
          </a>

          <div class="d-flex align-items-center gap-3">
            <% if current_user.doctor? %>
              <%= link_to doctor_analytics_path, class: "btn btn-outline-primary btn-sm" do %>
                <i class="bi bi-bar-chart-line me-1"></i> Analytics
              <% end %>
            <% end %>

            <span class="user-email">
              <i class="bi bi-person-circle me-1"></i>
              <%= current_user.email %>
            </span>

            <%= button_to "Logout", destroy_user_session_path, method: :delete,
                class: "btn btn-outline-danger btn-sm",
                form: { class: "d-inline" } %>
          </div>
        </div>
      </nav>
    <% end %>

    <main class="container main-container">
      <%= render 'shared/flash' %>
      <%= yield %>
    </main>

    <footer class="py-3 text-center text-muted">
      &copy; <%= Time.current.year %> Haoming624. All rights reserved.
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
  </body>
</html>